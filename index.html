<!DOCTYPE html>
<html lang="es-AR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Rolando Pantich - Cardi√≥logo</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root{--primary:#00BFA5;--primary-dark:#00897B;--secondary:#4A90E2;--danger:#E74C3C;--danger-dark:#C0392B;--warning:#F39C12;--dark:#2C3E50;--gray:#7F8C8D;--light-gray:#ECF0F1;--shadow:0 4px 20px rgba(0,0,0,0.1);--radius:16px}
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
        body{font-family:'Inter',-apple-system,sans-serif;background:#F5F7FA;color:var(--dark);line-height:1.6}
        .header{background:linear-gradient(135deg,var(--primary) 0%,var(--primary-dark) 100%);color:white;padding:20px;position:sticky;top:0;z-index:100;box-shadow:var(--shadow)}
        .header-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
        .back-btn{width:40px;height:40px;border-radius:50%;background:rgba(255,255,255,0.2);display:flex;align-items:center;justify-content:center;color:white;text-decoration:none}
        .header-title{font-size:18px;font-weight:600}
        .doctor-card{background:rgba(255,255,255,0.15);backdrop-filter:blur(10px);border-radius:var(--radius);padding:16px;display:flex;align-items:center;gap:16px}
        .doctor-avatar{width:60px;height:60px;border-radius:50%;background:white;display:flex;align-items:center;justify-content:center;font-size:28px;color:var(--primary)}
        .doctor-info h1{font-size:18px;font-weight:700;margin-bottom:4px}
        .doctor-info p{font-size:14px;opacity:0.9}
        .container{max-width:600px;margin:0 auto;padding:20px}
        .alert-box{background:linear-gradient(135deg,#FFF3E0 0%,#FFE0B2 100%);border-left:4px solid var(--warning);border-radius:8px;padding:16px;margin-bottom:20px;display:flex;gap:12px}
        .alert-box i{color:var(--warning);font-size:20px}
        .alert-box strong{color:#E65100;display:block;margin-bottom:4px}
        .section{background:white;border-radius:var(--radius);padding:20px;margin-bottom:20px;box-shadow:var(--shadow)}
        .section-title{font-size:16px;font-weight:700;margin-bottom:16px;display:flex;align-items:center;gap:8px}
        .question-number{width:28px;height:28px;background:var(--primary);color:white;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px}
        .days-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:20px}
        .day-card{background:var(--light-gray);border:2px solid transparent;border-radius:8px;padding:16px;text-align:center;cursor:pointer;transition:all 0.3s}
        .day-card:hover{transform:translateY(-2px);box-shadow:var(--shadow)}
        .day-card.active{background:#E0F7FA;border-color:var(--primary)}
        .day-name{font-size:12px;font-weight:600;color:var(--gray);text-transform:uppercase;margin-bottom:4px}
        .day-date{font-size:18px;font-weight:700;margin-bottom:8px}
        .day-slots{font-size:12px;padding:4px 12px;border-radius:12px;background:#27AE60;color:white;display:inline-block}
        .slots-container{display:none}
        .slots-container.active{display:block;animation:fadeIn 0.3s}
        @keyframes fadeIn{from{opacity:0}to{opacity:1}}
        .slots-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
        .slot-btn{background:white;border:2px solid var(--light-gray);border-radius:8px;padding:16px 8px;text-align:center;cursor:pointer;transition:all 0.2s}
        .slot-btn:hover:not(.disabled){border-color:var(--primary);transform:scale(1.02)}
        .slot-btn.selected{background:var(--primary);border-color:var(--primary);color:white}
        .slot-btn.disabled{background:var(--light-gray);color:var(--gray);cursor:not-allowed;opacity:0.7}
        .slot-time{font-size:16px;font-weight:600;display:block;margin-bottom:4px}
        .urgency-btn{width:100%;background:linear-gradient(135deg,var(--danger) 0%,var(--danger-dark) 100%);color:white;border:none;border-radius:var(--radius);padding:20px;cursor:pointer;position:relative;overflow:hidden;box-shadow:0 8px 25px rgba(231,76,60,0.3);animation:pulse-urgency 2s infinite}
        @keyframes pulse-urgency{0%,100%{transform:scale(1)}50%{transform:scale(1.02)}}
        .urgency-btn:disabled{background:var(--gray);animation:none;cursor:not-allowed}
        .urgency-content{display:flex;align-items:center;gap:16px}
        .urgency-icon{width:50px;height:50px;background:rgba(255,255,255,0.2);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px}
        .urgency-text{flex:1;text-align:left}
        .urgency-title{font-size:16px;font-weight:700;margin-bottom:2px}
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:1000;justify-content:flex-end;align-items:flex-end}
        .modal.active{display:flex}
        .modal-content{background:white;width:100%;max-height:90vh;border-radius:var(--radius) var(--radius) 0 0;overflow:hidden;animation:slideUp 0.3s}
        @keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
        .modal-header{background:var(--danger);color:white;padding:20px;display:flex;align-items:center;gap:12px}
        .modal-header.success{background:#27AE60}
        .modal-close{width:36px;height:36px;background:rgba(255,255,255,0.2);border:none;border-radius:50%;color:white;cursor:pointer;display:flex;align-items:center;justify-content:center}
        .modal-body{padding:24px;overflow-y:auto;max-height:calc(90vh - 80px)}
        .form-step{display:none}
        .form-step.active{display:block}
        .warning-box{background:#FADBD8;border-radius:8px;padding:16px;margin-bottom:24px;display:flex;gap:12px}
        .warning-box i{color:var(--danger);font-size:20px}
        .question-title{font-size:17px;font-weight:600;text-align:center;margin-bottom:20px;color:var(--dark)}
        .btn-group{display:flex;flex-direction:column;gap:12px}
        .btn-option{background:white;border:2px solid var(--light-gray);border-radius:8px;padding:16px;cursor:pointer;display:flex;align-items:center;gap:12px;transition:all 0.2s;text-align:left}
        .btn-option:hover{border-color:var(--primary);transform:translateX(4px)}
        .btn-option.selected{background:var(--primary);border-color:var(--primary);color:white}
        .btn-option.selected i{background:rgba(255,255,255,0.2)}
        .btn-option.danger{border-color:var(--danger)}
        .btn-option.danger.selected{background:var(--danger)}
        .btn-option i{font-size:20px;width:36px;height:36px;display:flex;align-items:center;justify-content:center;background:var(--light-gray);border-radius:50%}
        .btn-option-content{flex:1}
        .btn-option-title{font-weight:600;font-size:14px;display:block;margin-bottom:2px}
        .btn-option-subtitle{font-size:12px;opacity:0.8}
        .sub-question{margin-top:16px;padding:16px;background:#F8F9FA;border-radius:8px;border-left:3px solid var(--primary)}
        .sub-question-title{font-size:14px;font-weight:600;color:var(--gray);margin-bottom:12px;text-align:center}
        .input-group{margin-bottom:16px}
        .input-group.highlight{background:#FADBD8;padding:16px;border-radius:8px;border-left:4px solid var(--danger)}
        .input-label{display:block;font-size:14px;font-weight:600;margin-bottom:8px}
        input,textarea{width:100%;padding:14px;border:2px solid var(--light-gray);border-radius:8px;font-size:16px;font-family:inherit}
        input:focus,textarea:focus{outline:none;border-color:var(--primary)}
        .phone-prefix{position:absolute;left:16px;top:50%;transform:translateY(-50%);font-weight:600}
        input[type="tel"]{padding-left:80px}
        .checkbox-group{display:flex;flex-wrap:wrap;gap:8px}
        .checkbox-item{flex:1;min-width:120px}
        .checkbox-item input{display:none}
        .checkbox-label{display:block;padding:10px 12px;background:var(--light-gray);border-radius:8px;text-align:center;cursor:pointer;font-size:13px;border:2px solid transparent}
        .checkbox-item input:checked+.checkbox-label{background:var(--danger);color:white;border-color:var(--danger)}
        .btn-primary{width:100%;background:var(--secondary);color:white;border:none;border-radius:8px;padding:16px;font-size:16px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px;margin-top:20px}
        .btn-primary.btn-danger{background:var(--danger)}
        .success-container{text-align:center;padding:30px 20px}
        .success-icon{width:80px;height:80px;background:#D5F4E6;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 20px;font-size:40px;color:#27AE60}
        .success-title{font-size:22px;font-weight:700;color:#27AE60;margin-bottom:12px}
        .success-phone{font-size:18px;font-weight:700;color:var(--danger);display:block;margin:12px 0}
        .hidden{display:none!important}
        .mt-20{margin-top:20px}
        .loading{display:inline-block;width:20px;height:20px;border:3px solid rgba(255,255,255,0.3);border-radius:50%;border-top-color:white;animation:spin 1s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
        .progress-bar{height:4px;background:var(--light-gray);border-radius:2px;margin-bottom:20px;overflow:hidden}
        .progress-fill{height:100%;background:var(--primary);transition:width 0.3s ease}
    </style>
</head>
<body>
    <header class="header">
        <div class="header-top">
            <a href="#" class="back-btn"><i class="fas fa-arrow-left"></i></a>
            <span class="header-title">Agendar Turno</span>
            <div class="header-icon"><i class="fas fa-calendar-check"></i></div>
        </div>
        <div class="doctor-card">
            <div class="doctor-avatar"><i class="fas fa-user-md"></i></div>
            <div class="doctor-info">
                <h1>DR. ROLANDO PANTICH</h1>
                <p>‚ù§Ô∏è Cardi√≥logo</p>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="alert-box">
            <i class="fas fa-info-circle"></i>
            <div>
                <strong>Horario de Atenci√≥n</strong><br>
                MARTES Y JUEVES de 17:00 a 22:00 hs.<br>
                5 turnos programados + 2 cupos de urgencia por d√≠a.
            </div>
        </div>

        <!-- PREGUNTA 1 -->
        <section class="section" id="pregunta1">
            <h2 class="section-title">
                <div class="question-number">1</div>
                ¬øEs la primera vez que se atender√° con el Doctor?
            </h2>
            <div class="btn-group">
                <button class="btn-option" onclick="responderP1('SI_PRIMERA_VEZ', this)">
                    <i class="fas fa-star"></i>
                    <div class="btn-option-content">
                        <span class="btn-option-title">S√ç, ES LA PRIMERA VEZ</span>
                    </div>
                </button>
                <button class="btn-option" onclick="responderP1('NO_YA_ATENDIDO', this)">
                    <i class="fas fa-history"></i>
                    <div class="btn-option-content">
                        <span class="btn-option-title">NO.</span>
                    </div>
                </button>
            </div>
        </section>

        <!-- PREGUNTA 2 -->
        <section class="section hidden" id="pregunta2">
            <h2 class="section-title">
                <div class="question-number">2</div>
                Es usted de:
            </h2>
            <div class="btn-group">
                <button class="btn-option" onclick="responderP2('CORRIENTES_CAPITAL', this)">
                    <i class="fas fa-city"></i>
                    <div class="btn-option-content">
                        <span class="btn-option-title">S√ç, SOY DE CORRIENTES CAPITAL</span>
                    </div>
                </button>
                <button class="btn-option" onclick="responderP2('INTERIOR_PROVINCIA', this)">
                    <i class="fas fa-tractor"></i>
                    <div class="btn-option-content">
                        <span class="btn-option-title">SOY DEL INTERIOR DE LA PROVINCIA</span>
                    </div>
                </button>
                <button class="btn-option" onclick="responderP2('OTRA_PROVINCIA_PAIS', this)">
                    <i class="fas fa-plane"></i>
                    <div class="btn-option-content">
                        <span class="btn-option-title">SOY DE OTRA PROVINCIA/PA√çS</span>
                    </div>
                </button>
            </div>
            <div class="hidden mt-20" id="p2Extra">
                <div class="input-group">
                    <label class="input-label" id="p2Label">Especifique:</label>
                    <input type="text" id="p2Input" placeholder="">
                </div>
            </div>
            <button class="btn-primary" onclick="avanzarP3()">Continuar</button>
        </section>

        <!-- PREGUNTA 3 -->
        <section class="section hidden" id="pregunta3">
            <h2 class="section-title">
                <div class="question-number">3</div>
                El motivo de la consulta es:
            </h2>
            <div class="btn-group">
                <button class="btn-option" onclick="responderP3('CONTROL_MARCAPASOS', this)">
                    <i class="fas fa-heartbeat"></i>
                    <div class="btn-option-content">
                        <span class="btn-option-title">ES PARA CONTROL DE MARCAPASOS</span>
                    </div>
                </button>
                <button class="btn-option" onclick="responderP3('CONSULTA_SIMPLE', this)">
                    <i class="fas fa-stethoscope"></i>
                    <div class="btn-option-content">
                        <span class="btn-option-title">ES PARA CONSULTA SIMPLE</span>
                    </div>
                </button>
            </div>
            
            <!-- Sub-pregunta para consulta simple -->
            <div class="sub-question hidden" id="p3Sub">
                <div class="sub-question-title">¬øViene derivado por un colega?</div>
                <div class="btn-group">
                    <button class="btn-option" onclick="responderDerivacion(true, this)">
                        <i class="fas fa-user-md"></i>
                        <div class="btn-option-content">
                            <span class="btn-option-title">1- VIENE DERIVADO POR UN COLEGA</span>
                        </div>
                    </button>
                    <button class="btn-option" onclick="responderDerivacion(false, this)">
                        <i class="fas fa-user"></i>
                        <div class="btn-option-content">
                            <span class="btn-option-title">2- NO</span>
                        </div>
                    </button>
                </div>
                <div class="hidden mt-20" id="derivacionExtra">
                    <div class="input-group">
                        <label class="input-label">Nombre del m√©dico derivante</label>
                        <input type="text" id="nombreColega" placeholder="Dr./Dra. Nombre y Apellido">
                    </div>
                </div>
            </div>
            <button class="btn-primary" onclick="mostrarCalendario()">Ver Turnos Disponibles</button>
        </section>

        <!-- CALENDARIO -->
        <section class="section hidden" id="calendarioSection">
            <h2 class="section-title"><i class="fas fa-calendar-alt" style="color:var(--primary)"></i> Seleccionar D√≠a</h2>
            <div class="days-grid" id="daysGrid"></div>
        </section>

        <section class="section slots-container hidden" id="slotsSection">
            <h2 class="section-title"><i class="fas fa-clock" style="color:var(--secondary)"></i> Horarios Disponibles</h2>
            <div class="slots-grid" id="slotsGrid"></div>
            <button class="btn-primary" id="btnConfirmarTurno" disabled onclick="confirmarTurno()">
                <i class="fas fa-check"></i> Confirmar Turno
            </button>
        </section>

        <!-- BOT√ìN URGENCIA -->
        <section class="urgency-section hidden" id="urgenciaSection">
            <button class="urgency-btn" id="btnUrgencia" onclick="abrirModalUrgencia()">
                <div class="urgency-content">
                    <div class="urgency-icon"><i class="fas fa-ambulance"></i></div>
                    <div class="urgency-text">
                        <div class="urgency-title">üö® SOLICITAR TURNO DE URGENCIA</div>
                        <div style="font-size:13px;opacity:0.9" id="urgencyText">2 cupos disponibles hoy</div>
                        <div style="font-size:11px;opacity:0.8">Secretaria contactar√° en 30 min</div>
                    </div>
                </div>
            </button>
        </section>
    </main>

    <!-- MODAL URGENCIA -->
    <div class="modal" id="modalUrgencia">
        <div class="modal-content">
            <div class="modal-header" id="modalHeader">
                <i class="fas fa-ambulance"></i>
                <h2>Solicitud de Urgencia</h2>
                <button class="modal-close" onclick="cerrarModalUrgencia()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="form-step active" id="step1">
                    <div class="warning-box">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>Esta opci√≥n es <strong>SOLO para casos de URGENCIA</strong> que no pueden esperar.</p>
                    </div>
                    <div class="question-title">¬øRequiere atenci√≥n en las pr√≥ximas 24-48 horas?</div>
                    <div class="btn-group">
                        <button class="btn-option danger" onclick="document.getElementById('step1').classList.remove('active');document.getElementById('step2').classList.add('active')">
                            <i class="fas fa-check"></i>
                            <div>
                                <div style="font-weight:600">S√ç, ES URGENCIA</div>
                            </div>
                        </button>
                        <button class="btn-option" onclick="cerrarModalUrgencia()">
                            <i class="fas fa-arrow-left"></i>
                            <div>
                                <div style="font-weight:600">NO, PUEDO ESPERAR</div>
                            </div>
                        </button>
                    </div>
                </div>

                <div class="form-step" id="step2">
                    <div class="progress-bar"><div class="progress-fill" style="width:50%"></div></div>
                    <h3 style="margin-bottom:16px;text-align:center">Complete sus datos</h3>
                    <div class="input-group">
                        <label class="input-label">Nombre *</label>
                        <input type="text" id="urgNombre" placeholder="Ingrese su nombre">
                    </div>
                    <div class="input-group">
                        <label class="input-label">Apellido *</label>
                        <input type="text" id="urgApellido" placeholder="Ingrese su apellido">
                    </div>
                    <div class="input-group">
                        <label class="input-label">DNI *</label>
                        <input type="text" id="urgDni" placeholder="N√∫mero de documento">
                    </div>
                    <div class="input-group highlight">
                        <label class="input-label">üì± Tel√©fono para contacto URGENTE *</label>
                        <div style="position:relative">
                            <span class="phone-prefix">+54 9</span>
                            <input type="tel" id="urgTelefono" placeholder="11 1234 5678" maxlength="10">
                        </div>
                        <p style="font-size:11px;color:var(--danger);margin-top:6px"><i class="fas fa-exclamation-circle"></i> La secretaria contactar√° INMEDIATAMENTE</p>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Motivo de urgencia *</label>
                        <textarea id="urgMotivo" placeholder="Describa los s√≠ntomas..." rows="3"></textarea>
                    </div>
                    <div class="input-group">
                        <label class="input-label">¬øTiene dispositivo card√≠aco?</label>
                        <div class="checkbox-group">
                            <label class="checkbox-item"><input type="radio" name="dispositivo" value="marcapasos"><span class="checkbox-label">Marcapasos</span></label>
                            <label class="checkbox-item"><input type="radio" name="dispositivo" value="dai"><span class="checkbox-label">DAI</span></label>
                            <label class="checkbox-item"><input type="radio" name="dispositivo" value="ninguno" checked><span class="checkbox-label">Ninguno</span></label>
                            <label class="checkbox-item"><input type="radio" name="dispositivo" value="desconocido"><span class="checkbox-label">No s√©</span></label>
                        </div>
                    </div>
                    <button class="btn-primary btn-danger" onclick="enviarUrgencia()">
                        <i class="fas fa-paper-plane"></i> ENVIAR SOLICITUD
                    </button>
                </div>

                <div class="form-step" id="step3">
                    <div class="success-container">
                        <div class="success-icon"><i class="fas fa-check"></i></div>
                        <div class="success-title">¬°Solicitud Recibida!</div>
                        <p style="color:var(--gray);font-size:14px">La secretaria se contactar√° al <span class="success-phone" id="successPhone"></span> en menos de <strong>30 minutos</strong>.</p>
                        <button class="btn-primary" onclick="cerrarModalUrgencia();location.reload()">ENTENDIDO</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CONFIG={DIAS_ATENCION:[2,4],HORA_INICIO:17,HORA_FIN:22};
        let state={
            selectedDay:null,
            selectedSlot:null,
            cuposUrgencia:2,
            respuestas:{p1:null,p2:null,p2Extra:null,p3:null,derivado:null,nombreColega:null}
        };

        // Cargar cupos de urgencia desde localStorage
        if(localStorage.getItem('cuposUrgencia')){
            state.cuposUrgencia=parseInt(localStorage.getItem('cuposUrgencia'));
        }
        if(localStorage.getItem('ultimaFechaUrgencia')!==new Date().toDateString()){
            state.cuposUrgencia=2;
            localStorage.setItem('cuposUrgencia',2);
        }

        document.addEventListener('DOMContentLoaded',()=>{
            actualizarBotonUrgencia();
        });

        function responderP1(respuesta,element){
            state.respuestas.p1=respuesta;
            document.querySelectorAll('#pregunta1 .btn-option').forEach(el=>el.classList.remove('selected'));
            element.classList.add('selected');
            setTimeout(()=>{
                document.getElementById('pregunta1').classList.add('hidden');
                document.getElementById('pregunta2').classList.remove('hidden');
                document.getElementById('pregunta2').scrollIntoView({behavior:'smooth'});
            },300);
        }

        function responderP2(respuesta,element){
            state.respuestas.p2=respuesta;
            document.querySelectorAll('#pregunta2 .btn-option').forEach(el=>el.classList.remove('selected'));
            element.classList.add('selected');
            const extraDiv=document.getElementById('p2Extra');
            const extraInput=document.getElementById('p2Input');
            const extraLabel=document.getElementById('p2Label');
            extraDiv.classList.remove('hidden');
            if(respuesta==='INTERIOR_PROVINCIA'){
                extraLabel.textContent='¬øDe qu√© localidad?';
                extraInput.placeholder='Ej: Goya, Mercedes, Paso de los Libres...';
            }else if(respuesta==='OTRA_PROVINCIA_PAIS'){
                extraLabel.textContent='¬øDe qu√© provincia o pa√≠s?';
                extraInput.placeholder='Ej: Buenos Aires, Paraguay, Brasil...';
            }else{
                extraDiv.classList.add('hidden');
            }
        }

        function avanzarP3(){
            const extraInput=document.getElementById('p2Input');
            if(state.respuestas.p2!=='CORRIENTES_CAPITAL'&&!extraInput.value.trim()){
                alert('Por favor complete el campo');return;
            }
            state.respuestas.p2Extra=extraInput.value;
            document.getElementById('pregunta2').classList.add('hidden');
            document.getElementById('pregunta3').classList.remove('hidden');
            document.getElementById('pregunta3').scrollIntoView({behavior:'smooth'});
        }

        function responderP3(respuesta,element){
            state.respuestas.p3=respuesta;
            document.querySelectorAll('#pregunta3 .btn-option').forEach(el=>el.classList.remove('selected'));
            element.classList.add('selected');
            const subDiv=document.getElementById('p3Sub');
            if(respuesta==='CONSULTA_SIMPLE'){
                subDiv.classList.remove('hidden');
            }else{
                subDiv.classList.add('hidden');
                state.respuestas.derivado=false;
            }
        }

        function responderDerivacion(esDerivado,element){
            state.respuestas.derivado=esDerivado;
            document.querySelectorAll('#p3Sub .btn-option').forEach(el=>el.classList.remove('selected'));
            element.classList.add('selected');
            const extraDiv=document.getElementById('derivacionExtra');
            if(esDerivado){
                extraDiv.classList.remove('hidden');
            }else{
                extraDiv.classList.add('hidden');
            }
        }

        function mostrarCalendario(){
            if(state.respuestas.p3==='CONSULTA_SIMPLE'&&state.respuestas.derivado===null){
                alert('Por favor indique si viene derivado');return;
            }
            if(state.respuestas.derivado&&!document.getElementById('nombreColega').value.trim()){
                alert('Por favor indique el nombre del m√©dico derivante');return;
            }
            state.respuestas.nombreColega=document.getElementById('nombreColega').value;
            document.getElementById('pregunta3').classList.add('hidden');
            document.getElementById('calendarioSection').classList.remove('hidden');
            document.getElementById('urgenciaSection').classList.remove('hidden');
            generarDias();
            document.getElementById('calendarioSection').scrollIntoView({behavior:'smooth'});
        }

        function generarDias(){
            const container=document.getElementById('daysGrid');
            const hoy=new Date();
            let html='',diasGen=0,fecha=new Date(hoy);
            while(diasGen<8){
                fecha.setDate(fecha.getDate()+1);
                const diaSem=fecha.getDay();
                if(CONFIG.DIAS_ATENCION.includes(diaSem)){
                    const nombre=diaSem===2?'Martes':'Jueves';
                    const fechaStr=fecha.toLocaleDateString('es-AR',{day:'numeric',month:'short'});
                    const fechaISO=fecha.toISOString().split('T')[0];
                    const cupos=Math.floor(Math.random()*5)+1;
                    html+=`<div class="day-card" onclick="seleccionarDia('${fechaISO}','${nombre}',this)"><div class="day-name">${nombre}</div><div class="day-date">${fechaStr}</div><span class="day-slots ${cupos<=2?'low':''}">${cupos} cupos</span></div>`;
                    diasGen++;
                }
            }
            container.innerHTML=html;
        }

        function seleccionarDia(fecha,nombre,el){
            document.querySelectorAll('.day-card').forEach(c=>c.classList.remove('active'));
            el.classList.add('active');
            state.selectedDay={fecha,nombre};
            document.getElementById('slotsSection').classList.remove('hidden');
            generarHorarios();
            setTimeout(()=>document.getElementById('slotsSection').scrollIntoView({behavior:'smooth'}),100);
        }

        function generarHorarios(){
            const container=document.getElementById('slotsGrid');
            let html='';
            for(let h=CONFIG.HORA_INICIO;h<CONFIG.HORA_FIN;h++){
                const horaStr=`${h.toString().padStart(2,'0')}:00`;
                const ocupado=Math.random()>0.7;
                html+=`<button class="slot-btn ${ocupado?'disabled':''}" onclick="seleccionarHora('${horaStr}',this)" ${ocupado?'disabled':''}><span class="slot-time">${horaStr}</span><span style="font-size:11px">${ocupado?'Ocupado':'Disponible'}</span></button>`;
            }
            container.innerHTML=html;
        }

        function seleccionarHora(hora,el){
            if(el.classList.contains('disabled'))return;
            document.querySelectorAll('.slot-btn').forEach(b=>b.classList.remove('selected'));
            el.classList.add('selected');
            state.selectedSlot=hora;
            document.getElementById('btnConfirmarTurno').disabled=false;
        }

        function confirmarTurno(){
            if(!state.selectedDay||!state.selectedSlot)return;
            
            // Crear evento en Google Calendar
            const evento={
                titulo:`Consulta - ${state.respuestas.p3==='CONTROL_MARCAPASOS'?'Control Marcapasos':'Consulta Cardiolog√≠a'}`,
                fecha:state.selectedDay.fecha,
                hora:state.selectedSlot,
                paciente:'Paciente',
                tipo:state.respuestas.p3
            };
            
            agregarAGoogleCalendar(evento);
            
            alert(`‚úÖ Turno confirmado:\n${state.selectedDay.nombre} ${state.selectedDay.fecha}\nHora: ${state.selectedSlot}\n\nSe abrir√° Google Calendar para agendar.`);
        }

        function agregarAGoogleCalendar(evento){
            const fecha=evento.fecha;
            const hora=evento.hora;
            const startDate=new Date(`${fecha}T${hora}:00`);
            const endDate=new Date(startDate.getTime()+60*60*1000);
            const googleCalendarUrl=`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(evento.titulo)}&dates=${startDate.toISOString().replace(/[-:]/g,'').split('.')[0]}/${endDate.toISOString().replace(/[-:]/g,'').split('.')[0]}&details=${encodeURIComponent('Dr. Rolando Pantich - Cardi√≥logo')}&location=${encodeURIComponent('Corrientes, Argentina')}`;
            window.open(googleCalendarUrl,'_blank');
        }

        function actualizarBotonUrgencia(){
            const btn=document.getElementById('btnUrgencia');
            const text=document.getElementById('urgencyText');
            if(state.cuposUrgencia<=0){
                btn.disabled=true;
                text.textContent='Cupos completos';
                text.style.color='#FADBD8';
            }else{
                text.textContent=`${state.cuposUrgencia} cupo${state.cuposUrgencia>1?'s':''} disponible${state.cuposUrgencia>1?'s':''} hoy`;
            }
        }

        function abrirModalUrgencia(){
            if(state.cuposUrgencia<=0){alert('No hay cupos de urgencia disponibles. En caso de emergencia, acuda a la guardia.');return;}
            document.getElementById('modalUrgencia').classList.add('active');
        }

        function cerrarModalUrgencia(){
            document.getElementById('modalUrgencia').classList.remove('active');
        }

        function enviarUrgencia(){
            const nombre=document.getElementById('urgNombre').value.trim();
            const apellido=document.getElementById('urgApellido').value.trim();
            const dni=document.getElementById('urgDni').value.trim();
            const tel=document.getElementById('urgTelefono').value.trim();
            const motivo=document.getElementById('urgMotivo').value.trim();
            
            if(!nombre||!apellido||!dni||!tel||!motivo){alert('Complete todos los campos');return;}
            if(tel.length<10){alert('Tel√©fono inv√°lido');return;}
            
            // Reducir cupos y guardar en localStorage
            state.cuposUrgencia--;
            localStorage.setItem('cuposUrgencia',state.cuposUrgencia);
            localStorage.setItem('ultimaFechaUrgencia',new Date().toDateString());
            
            const btn=document.querySelector('#step2 .btn-danger');
            btn.innerHTML='<span class="loading"></span> Enviando...';
            btn.disabled=true;
            
            setTimeout(()=>{
                actualizarBotonUrgencia();
                document.getElementById('successPhone').textContent=`11 ${tel}`;
                document.getElementById('step2').classList.remove('active');
                document.getElementById('step3').classList.add('active');
                document.getElementById('modalHeader').classList.add('success');
                
                // Enviar notificaci√≥n por email (simulado)
                enviarNotificacionEmail({nombre,apellido,tel,motivo});
            },1500);
        }

        function enviarNotificacionEmail(datos){
            // En producci√≥n, esto se conecta a un backend
            console.log('üìß Email enviado al Dr. Pantich:',{
                para:'dr.pantich@gmail.com',
                asunto:'üö® Nueva Urgencia - Paciente ' + datos.nombre + ' ' + datos.apellido,
                telefono:datos.tel,
                motivo:datos.motivo,
                fecha:new Date().toLocaleString()
            });
        }

        window.onclick=e=>{
            if(e.target.classList.contains('modal'))cerrarModalUrgencia();
        }
    </script>
</body>
</html>